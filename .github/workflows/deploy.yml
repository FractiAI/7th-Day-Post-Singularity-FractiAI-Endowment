name: Deploy to Cloud

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy-github-pages:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        continue-on-error: true
      
      - name: Deployment Status
        if: always()
        run: |
          if [ "${{ steps.deployment.outcome }}" == "success" ]; then
            echo "‚úÖ GitHub Pages deployment successful"
          else
            echo "‚ö†Ô∏è GitHub Pages deployment had issues (check logs above)"
          fi

  deploy-vercel:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Vercel CLI
        run: npm install -g vercel@latest
      
      - name: Deploy to Vercel
        run: |
          if [ -z "$VERCEL_TOKEN" ]; then
            echo "‚ö†Ô∏è VERCEL_TOKEN not set, skipping Vercel deployment"
            echo "‚ÑπÔ∏è  To enable Vercel deployment, set VERCEL_TOKEN secret in GitHub"
            exit 0
          fi
          echo "üöÄ Deploying to Vercel..."
          vercel --prod --token $VERCEL_TOKEN --yes || {
            echo "‚ö†Ô∏è Vercel deployment failed, but continuing..."
            exit 0
          }
          echo "‚úÖ Vercel deployment completed"
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        continue-on-error: true

  deploy-supabase:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Supabase CLI
        run: npm install -g supabase@latest
      
      - name: Deploy to Supabase
        run: |
          if [ -z "$SUPABASE_ACCESS_TOKEN" ] || [ -z "$SUPABASE_PROJECT_REF" ]; then
            echo "‚ö†Ô∏è Supabase secrets not set, skipping Supabase deployment"
            echo "‚ÑπÔ∏è  To enable Supabase deployment, set SUPABASE_ACCESS_TOKEN and SUPABASE_PROJECT_REF secrets"
            exit 0
          fi
          echo "üîó Linking Supabase project..."
          supabase link --project-ref $SUPABASE_PROJECT_REF --password $SUPABASE_ACCESS_TOKEN || {
            echo "‚ö†Ô∏è Failed to link Supabase project, continuing..."
            exit 0
          }
          echo "üì¶ Deploying Supabase storage..."
          supabase storage deploy || {
            echo "‚ö†Ô∏è Failed to deploy Supabase storage, continuing..."
            exit 0
          }
          echo "‚úÖ Supabase deployment completed"
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
          SUPABASE_PROJECT_REF: ${{ secrets.SUPABASE_PROJECT_REF }}
        continue-on-error: true

